import pybars
from core.domain import TicketRecord
from common.repository import compiler


greet = "\n".join((
    "ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð‘Ð°ÑƒÐ¼Ð°Ð½ÐµÑ†!",
    "Ð Ð°Ð´Ñ‹ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ñ‚ÐµÐ±Ñ Ð² Ð½Ð°ÑˆÐµÐ¼ Ð±Ð¾Ñ‚Ðµ! Ð—Ð´ÐµÑÑŒ Ñ‚Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ:",
    "ðŸ”¹ Ð—Ð°Ð´Ð°Ñ‚ÑŒ Ð»ÑŽÐ±Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ‚ÐµÐ±Ñ Ð²Ð¾Ð»Ð½ÑƒÑŽÑ‚.",
    "ðŸ”¹ Ð¡Ð¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ Ð¾ Ð²Ð¾Ð·Ð½Ð¸ÐºÑˆÐµÐ¹ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ðµ.",
    "ðŸ”¹ ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ñ‚ÑŒ ÑÐ²Ð¾ÑŽ Ð¸Ð´ÐµÑŽ.",
))

create_ticket = \
    "Ð§Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¶Ð¼Ð¸ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ."

choice_issue = "\n".join((
    "Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ñ‚Ð¸Ð¿ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ:",
    "ðŸ”§ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° â€“ Ñ€Ð°ÑÑÐºÐ°Ð¶Ð¸, Ñ‡Ñ‚Ð¾ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ.",
    "â“ Ð’Ð¾Ð¿Ñ€Ð¾Ñ â€“ Ð·Ð°Ð´Ð°Ð¹ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÑƒÑŽÑ‰Ð¸Ð¹ Ñ‚ÐµÐ±Ñ Ð²Ð¾Ð¿Ñ€Ð¾Ñ.",
    "ðŸ’¡ ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ â€“ Ð¿Ð¾Ð´ÐµÐ»Ð¸ÑÑŒ ÑÐ²Ð¾Ð¸Ð¼Ð¸ Ð¸Ð´ÐµÑÐ¼Ð¸ Ð¸ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ñ‚Ð¸Ð²Ð°Ð¼Ð¸!",
))

choice_category = \
    "Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ, Ñ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¼ ÑÐ²ÑÐ·Ð°Ð½Ð¾ Ñ‚Ð²Ð¾Ñ‘ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ."

choice_privacy = "\n".join((
    "ðŸ¤« Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ð¾?",
    "ÐšÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ â€“ Ð½Ð°Ñˆ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ Ð´Ñ€ÑƒÐ³ Ð¿Ð¾ÑÐ»Ðµ Ð²Ð°Ñ!"
))

input_full_name = \
    "Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ð¾Ñ‘ Ð¤Ð˜Ðž Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¼Ñ‹ Ð·Ð½Ð°Ð»Ð¸, Ñ ÐºÐµÐ¼ Ð² ÑÐ»ÑƒÑ‡Ð°Ðµ Ñ‡ÐµÐ³Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ ÑÐ²ÑÐ·Ð°Ñ‚ÑŒÑÑ."

input_study_group = \
    "Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ð¾ÑŽ ÑƒÑ‡ÐµÐ±Ð½ÑƒÑŽ Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ Ð˜Ð£13-13Ð‘."

input_text = \
    "Ð Ð°ÑÑÐºÐ°Ð¶Ð¸, Ð² Ñ‡Ñ‘Ð¼ ÑÑƒÑ‚ÑŒ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ."

choice_approve = \
    "ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´Ð°ÐµÑˆÑŒ Ð²Ð²ÐµÐ´Ñ‘Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ?"


def ticket_sent(ticket_id: int) -> str:
    return f"Ð¢Ð²Ð¾Ñ‘ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾! Ð•Ð¼Ñƒ Ð¿Ñ€Ð¸ÑÐ²Ð¾Ð¸Ð»Ð¸ Ð½Ð¾Ð¼ÐµÑ€ #{ticket_id}"


ticket_channel_template = compiler.compile("""
ÐžÐ±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ #{{ticket.id}}
=================================
Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: {{as_tag ticket.status}}
Ð¢Ð¸Ð¿ Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð¸Ñ: {{as_tag ticket.issue}}
ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ: {{as_tag ticket.category}}
Ð—Ð°ÑÐ²Ð¸Ñ‚ÐµÐ»ÑŒ: {{#if ticket.owner}}{{ticket.owner}}{{else}}Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ð¾{{/if}}
=================================
{{ticket.text}}
""")


def ticket_channel(ticket: TicketRecord) -> str:
    return ticket_channel_template(
        {
            "ticket": ticket,
        },
        helpers={"as_tag": as_tag}
    )


def as_tag(this, s) -> str:
    return "#" + s.lower().replace(" ", "")

